---
- name: Install git (RHEL7)
  ansible.builtin.yum:
    name:
      - git
    state: present
  become: yes
  when: "(ansible_distribution == 'Amazon' and ansible_distribution_major_version == '2') or
         (ansible_distribution == 'CentOS' and ansible_distribution_major_version == '7')"
- name: Install git (RHEL8)
  ansible.builtin.dnf:
    name:
      - git
    state: present
  become: yes
  when: "(ansible_distribution == 'Amazon' and ansible_distribution_major_version == '2022') or
         (ansible_distribution == 'CentOS' and ansible_distribution_major_version == '8')"

- name: Clone puppet-install repository
  ansible.builtin.git:
    repo: https://github.com/newrelic/puppet-install.git
    dest: /home/puppet-install
  become: true

- name: Build newrelic-newrelic_installer using PDK
  shell: |
    cd /home/puppet-install
    /usr/local/bin/pdk build --force
  become: true